# Using The Metasploit Framework
* Metasploit Framework, a tool that has become the de facto standard for penetration testers.
* Metasploit is now owned by the security company Rapid7, an open-source edition is still available, with development largely driven by the security community.
* Metasploit is intuitive and easy to use, and it offers a centralized way to run trusted exploit code that has been vetted for accuracy by the security community.

## Public Vulnerabilities Exploiting Code
* Let's say you found a vulnerability that you want to exploit what you can do is, search for code that exploits this vulnerability on the Internet.
* Sites like Packet Storm Security (http://www.packetstormsecurity.com/), SecurityFocus (http://www.securityfocus.com/), and Exploit Database (http://www.exploit-db.com/) provide repositories of known exploit code.
* But be forewarned: Not all public exploit code does what it claims to do.
* Some exploit code may destroy the target system or even attack your system instead of the target. You should always be vigilant when running anything you find online and read through the code carefully before trusting it.
* Additionally, the public exploits you find may not meet your needs right out of the box. You may need to do some additional work to port them to your pentest environment.
* Alternatively, you can use Metasploit to make exploiting known vulnerabilities quick and painless.

## Starting Metasploit
* In Kali Linux, Metasploit is in our path, so we can start it anywhere on the system.
* Before you start Metasploit, you will want to start the PostgreSQL database, which Metasploit will use to track what you do (*service postgresql start*)
* Now you’re ready to start the Metasploit service. This command creates a PostgreSQL user called msf3 and a corresponding database to store our data. It also starts Metasploit’s remote procedure call (RPC) server and web server (*sudo msfdb init*).
* There are multiple interfaces for using Metasploit. Msfconsole, the Metasploit text-based console, and Msfcli, the command line interface and more.
* To verify database connectivity lunch msfconsole (*msfconsole*) and use the database status command (*db_status*)
* If you’re ever stuck when using Msfconsole, enter help for a list of available commands and a description of what they do.
* For more detailed information about a specific command, including usage, enter help followed by the command name (*help COMMANDNAME*).
* Metasploit also has an online database of modules (http://www.rapid7.com/db/modules/) and a built-in search function that you can use to search for the correct modules.

## The Module Database
* You can use the Metasploit search page to match Metasploit modules to vulnerabilities by Common Vulnerabilities and Exposures (CVE) number, Open Sourced Vulnerability Database (OSVDB) ID, Bugtraq ID, or Microsoft Security Bulletin, or you can search the full text of the module information for a string.

### Built-In Search
* Just type search followed by the name of the vulnerability (*search VULNERABILITYNAME*).

## Info Page
* Once you’ve identified a module to use, enter the info command with the module name (*info MODULENAME*).
* First we see some basic information about the module, including a descriptive name.
* Followed by the module name
* Platform, which tells us which system is this exploit valid for.
* Privileged, tells us whether this module requires or grants high privileges on the target.
* Rank, lists the exploit’s potential impact on the target. Exploits are ranked from manual to excellent.
* Available targets, lists operating system versions and patch levels that the module can exploit.
* Basic options, lists various options for the module that can be set to make a module better meet our needs.
* Payload information, contains information to help Metasploit decide which payloads it can use with this exploit.
* Description, includes more details about the particular vulnerability that the module exploits.
* References, contains a link to online vulnerability database entries.

## Setting Module Options
* Having confirmed that this is the right module, tell Metasploit to use this module with the command *use MODULENAME*.
* Having chosen our exploit, we need to give Metasploit some information.
* To see the information Metasploit needs from you to run your chosen module, enter *show options*.
* RHOST: Refers to the remote host we want to exploit (The Target) (*set RHOST IPADDRESS*).
* RPORT: Refers to the remote port to attack (*set RPORT IPADDRESS*).
* Exploit Target: This is the target operating system and version (The Exploit Target is set to 0 Automatic Targeting) (*set target TARGETNUMBER*).
* You can view the available targets on the module’s info page or just show them with the command *show targets*.

## Payloads (Shellcode)
* Metasploit has a plethora of payloads, ranging from simple Windows commands to the extensible Metasploit Meterpreter.
* To see compatible payloads, enter *show payloads* command.
* To set a payload you use the command *set payload PAYLOADTYPE*.
* To run the module enter the command *exploit*.

### Types of Shells
* Bind Shells:
  -  A bind shell instructs the target machine to open a command shell and listen on a local port.
  -  The attack machine then connects to the target machine on the listening port. However, with the advent of firewalls, the effectiveness of bind shells has fallen because any correctly configured firewall will block traffic to some random port like 4444.
    
* Reverse Shells
  -  A reverse shell, on the other hand, actively pushes a connection back to the attack machine rather than waiting for an incoming connection.
  -  In this case, on our attack machine we open a local port and listen for a connection from our target because this reverse connection is more likely to make it through a firewall.
  -  For reverse shells we need to set LHOST and LPORT which are the listening host and listening port (usually our machine's info).


# Extra Notes:
* An important thing to note about the default options is that Metasploit uses the port 4444. In our lab there is nothing wrong with this. It will work just fine. However, on real engagements, if your client is using even primitive intrusion-prevention software, it may take note of traffic on port 4444 and say, “Hey, you are Metasploit, go away!” and drop your connection.
* Modern firewalls allow you to stop outbound connections as well as inbound ones. It would be trivial to stop a host in your environment from connecting out, for instance, to port 4444. But say I set up my listener on port 80 or port 443. To a firewall, that will look like web traffic.
